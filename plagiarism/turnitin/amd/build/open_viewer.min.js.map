{"version":3,"sources":["../src/open_viewer.js"],"names":["define","$","origreport_open","that","document","on","classList","attr","replace","split","i","length","indexOf","classStr","openDV","grademark_open","url","html","dvtype","submissionid","coursemoduleid","dvWindow","window","open","loading","M","cfg","wwwroot","str","plagiarism_turnitin","loadingdv","body","ajax","type","dataType","data","action","cmid","sesskey","success","forms","submit","close","checkDVClosed","closed","refreshScores","setTimeout","submission_id","submission","location"],"mappings":"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","sourcesContent":["/**\n * Javascript controller for opening the originality report viewreport\n\n * @package plagiarism_turnitin\n * @copyright 2019 Turnitin\n * @author Charlotte Spinks <cspinks@turnitin.com>\n * @module plagiarism_turnitin/open_viewer\n */\n\ndefine(['jquery'], function($) {\n    return {\n        origreport_open: function() {\n            var that = this;\n            $(document).on('click', '.pp_origreport_open', function() {\n                var classList = $(this).attr('class').replace(/\\s+/,' ').split(' ');\n\n                for (var i = 0; i < classList.length; i++) {\n                    if (classList[i].indexOf('origreport_') !== -1 && classList[i] != 'pp_origreport_open') {\n                        var classStr = classList[i].split(\"_\");\n                        that.openDV(\"origreport\", classStr[1], classStr[2]);\n                    }\n                }\n             });\n        },\n\n        grademark_open: function() {\n            var that = this;\n            $(document).on('click', '.pp_grademark_open', function() {\n                var classList = $(this).attr('class').replace(/\\s+/,' ').split(' ');\n\n                for (var i = 0; i < classList.length; i++) {\n                    if (classList[i].indexOf('grademark_') !== -1 && classList[i] != 'pp_grademark_open') {\n                        var classStr = classList[i].split(\"_\");\n                        var url = \"\";\n                        // URL must be stored in separate div on forums.\n                        if ($('.grademark_forum_launch_' + classStr[1]).length > 0) {\n                            url = $('.grademark_forum_launch_' + classStr[1]).html();\n                        } else {\n                            url = $(this).attr(\"id\");\n                        }\n                        that.openDV(\"grademark\", classStr[1], classStr[2], url);\n                    }\n                }\n            });\n        },\n\n        // Open the DV in a new window in such a way as to not be blocked by popups.\n        openDV: function(dvtype, submissionid, coursemoduleid) {\n          var that = this;\n          var dvWindow = window.open('', 'turnitin_viewer');\n\n          var loading = '<div class=\"tii_dv_loading\" style=\"text-align:center;\">';\n          loading += '<img src=\"' + M.cfg.wwwroot + '/plagiarism/turnitin/pix/tiiIcon.svg\" style=\"width:100px; height: 100px\">';\n          loading += '<p style=\"font-family: Arial, Helvetica, sans-serif;\">' + M.str.plagiarism_turnitin.loadingdv + '</p>';\n          loading += '</div>';\n          $(dvWindow.document.body).html(loading);\n\n          // Get html to launch DV.\n          $.ajax({\n              type: \"POST\",\n              url: M.cfg.wwwroot + \"/plagiarism/turnitin/ajax.php\",\n              dataType: \"json\",\n              data: {\n                  action: \"get_dv_html\",\n                  submissionid: submissionid,\n                  dvtype: dvtype,\n                  cmid: coursemoduleid,\n                  sesskey: M.cfg.sesskey\n              },\n              success: function(data) {\n                  $(dvWindow.document.body).html(loading + data);\n                  dvWindow.document.forms[0].submit();\n                  dvWindow.document.close();\n\n                  that.checkDVClosed(submissionid, coursemoduleid, dvWindow);\n              }\n          });\n        },\n\n        checkDVClosed: function(submissionid, coursemoduleid, dvWindow) {\n            var that = this;\n\n            if (dvWindow.closed) {\n                that.refreshScores(submissionid, coursemoduleid);\n            } else {\n                setTimeout( function(){\n                    that.checkDVClosed(submissionid, coursemoduleid, dvWindow);\n                }, 500);\n            }\n         },\n\n         refreshScores: function(submission_id, coursemoduleid) {\n              $.ajax({\n                  type: \"POST\",\n                  url: M.cfg.wwwroot + \"/plagiarism/turnitin/ajax.php\",\n                  dataType: \"json\",\n                  data: {\n                      action: \"update_grade\",\n                      submission: submission_id,\n                      cmid: coursemoduleid,\n                      sesskey: M.cfg.sesskey\n                  },\n                  success: function() {\n                      window.location = window.location;\n                  }\n              });\n         }\n    };\n});\n"],"file":"open_viewer.min.js"}