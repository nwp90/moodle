{"version":3,"sources":["../src/question.js"],"names":["define","t","currentHeight","init","window","frameElement","resizeContainingFrame","document","compatMode","setInterval","documentElement","style","height","querySelectorAll","forEach","element","setAttribute","Y","use","M","core_formchangechecker","formid","body","offsetHeight"],"mappings":"AAwBAA,OAAM,iCAAC,EAAD,CAAK,UAAW,CAClB,GAAIC,CAAAA,CAAC,CAAG,CAIJC,aAAa,CAAE,IAJX,CASJC,IAAI,CAAE,eAAW,CAEb,GAAI,CAACC,MAAM,CAACC,YAAZ,CAA0B,CACtB,MACH,CAGDJ,CAAC,CAACK,qBAAF,GAMA,GAAmC,WAA/B,QAAOC,CAAAA,QAAQ,CAACC,UAAhB,EAAsE,YAAxB,GAAAD,QAAQ,CAACC,UAA3D,CAAwF,CACpFC,WAAW,CAACR,CAAC,CAACK,qBAAH,CAA0B,GAA1B,CACd,CAKDC,QAAQ,CAACG,eAAT,CAAyBC,KAAzB,CAA+B,YAA/B,EAA+C,QAA/C,CACAJ,QAAQ,CAACG,eAAT,CAAyBC,KAAzB,CAA+BC,MAA/B,CAAwC,MAAxC,CAGAL,QAAQ,CAACM,gBAAT,CAA0B,iBAA1B,EAA6CC,OAA7C,CAAqD,SAASC,CAAT,CAAkB,CACnEA,CAAO,CAACC,YAAR,CAAqB,QAArB,CAA+B,MAA/B,CACH,CAFD,EAIAC,CAAC,CAACC,GAAF,CAAM,+BAAN,CAAuC,UAAW,CAC9CC,CAAC,CAACC,sBAAF,CAAyBjB,IAAzB,CAA8B,CAACkB,MAAM,CAAE,cAAT,CAA9B,CACH,CAFD,CAGH,CAxCG,CA6CJf,qBAAqB,CAAE,gCAAW,CAM9B,GAAIL,CAAC,CAACC,aAAF,GAAoBK,QAAQ,CAACe,IAAT,CAAcC,YAAtC,CAAoD,CAChD,MACH,CAGDtB,CAAC,CAACC,aAAF,CAAkBK,QAAQ,CAACe,IAAT,CAAcC,YAAhC,CAEAnB,MAAM,CAACC,YAAP,CAAoBM,KAApB,CAA0BC,MAA1B,CAAoCX,CAAC,CAACC,aAAF,CAAkB,EAAnB,CAAyB,IAC/D,CA3DG,CAAR,CA6DA,MAAOD,CAAAA,CACV,CA/DK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * The module resizes the iframe containing the embedded question to be\n * just the right size for the question.\n *\n * @module    filter_embedquestion/question\n * @package   filter_embedquestion\n * @copyright 2018 The Open University\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([], function() {\n    var t = {\n        /**\n         * The last height we set on the iframe, so we only try to change it when it changes.\n         */\n        currentHeight: null,\n\n        /**\n         * Initialise method.\n         */\n        init: function() {\n            // Only initialise if we are in a frame.\n            if (!window.frameElement) {\n                return;\n            }\n\n            // Initialise the resize logic.\n            t.resizeContainingFrame();\n\n            // If something like an error causes junk to be output before the open <html> tag,\n            // then that puts the document into BackCompat rendering mode, and the iframe keeps\n            // getting bigger and bigger. So, only do the continual resize logic if the browser\n            // is in standards compliant rendering mode.\n            if (typeof document.compatMode !== 'undefined' && document.compatMode !== \"BackCompat\") {\n                setInterval(t.resizeContainingFrame, 100);\n            }\n\n            // Prevent a vertical scroll-bar in all cases.\n            // We can't do this in the CSS, because there is no suitable class on\n            // the <html> tag.\n            document.documentElement.style['overflow-y'] = 'hidden';\n            document.documentElement.style.height = 'auto';\n\n            // Make the edit question link (if present) open in the full window.\n            document.querySelectorAll('.editquestion a').forEach(function(element) {\n                element.setAttribute('target', '_top');\n            });\n\n            Y.use('moodle-core-formchangechecker', function() {\n                M.core_formchangechecker.init({formid: 'responseform'});\n            });\n        },\n\n        /**\n         * Set the size of the containing frame to what we need.\n         */\n        resizeContainingFrame: function() {\n            // It seems sensible to use scrollHeight in this function, but that is\n            // buggy in Safari. https://bugs.webkit.org/show_bug.cgi?id=25240 has\n            // a useful table showing that body.offsetHeight is reliable.\n\n            // Has the height changed?\n            if (t.currentHeight === document.body.offsetHeight) {\n                return; // No.\n            }\n\n            // Resize required. Do it.\n            t.currentHeight = document.body.offsetHeight;\n            // Extra height to allow for any horizontal scroll bar.\n            window.frameElement.style.height = (t.currentHeight + 25) + \"px\";\n        }\n    };\n    return t;\n});\n"],"file":"question.min.js"}