{"version":3,"sources":["../src/migration_tool_launch.js"],"names":["define","$","Templates","ModalFactory","ModalEvents","ModalMigrationTool","MigrationToolMigrate","migration_tool_launch","ajax","M","cfg","wwwroot","action","turnitintoolid","data","sesskey","migrated","window","location","href","v2id","create","type","TYPE","then","modal","show","hide","migration_tool_migrate"],"mappings":"AASAA,OAAM,6CAAC,CAAC,QAAD,CACC,gBADD,CAEC,oBAFD,CAGC,mBAHD,CAIC,0CAJD,CAKC,4CALD,CAAD,CAOF,SAASC,CAAT,CAAYC,CAAZ,CAAuBC,CAAvB,CAAqCC,CAArC,CAAkDC,CAAlD,CAAsEC,CAAtE,CAA4F,CACxF,MAAO,CACHC,qBAAqB,CAAE,gCAAW,CAE9BN,CAAC,CAACO,IAAF,CAAO,CACH,SAAY,MADT,CAEH,KAAQ,MAFL,CAGH,IAAOC,CAAC,CAACC,GAAF,CAAMC,OAAN,CAAgB,+BAHpB,CAIH,KAAQ,CACJC,MAAM,CAAE,gBADJ,CAEJC,cAAc,CAAEZ,CAAC,CAAC,eAAD,CAAD,CAAmBa,IAAnB,CAAwB,gBAAxB,CAFZ,CAGJC,OAAO,CAAEN,CAAC,CAACC,GAAF,CAAMK,OAHX,CAJL,CASH,QAAW,iBAASD,CAAT,CAAe,CACtB,GAAI,KAAAA,CAAI,CAACE,QAAT,CAA4B,CACxBC,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAuBV,CAAC,CAACC,GAAF,CAAMC,OAAN,CAAgB,mCAAhB,CAAoDG,CAAI,CAACM,IACnF,CAFD,IAEO,CACHjB,CAAY,CAACkB,MAAb,CAAoB,CAChBC,IAAI,CAAEjB,CAAkB,CAACkB,IADT,CAApB,EAGCC,IAHD,CAGM,SAASC,CAAT,CAAgB,CAClBA,CAAK,CAACC,IAAN,GAGA,GAA+C,CAA3C,GAAAzB,CAAC,CAAC,eAAD,CAAD,CAAmBa,IAAnB,CAAwB,aAAxB,CAAJ,CAAkD,CAC9Cb,CAAC,CAAC,eAAD,CAAD,CAAmB0B,IAAnB,GACA1B,CAAC,CAAC,YAAD,CAAD,CAAgByB,IAAhB,GAEApB,CAAoB,CAACsB,sBAArB,CACI3B,CAAC,CAAC,eAAD,CAAD,CAAmBa,IAAnB,CAAwB,UAAxB,CADJ,CAEIb,CAAC,CAAC,eAAD,CAAD,CAAmBa,IAAnB,CAAwB,gBAAxB,CAFJ,CAIH,CACJ,CAhBD,CAiBH,CACJ,CA/BE,CAAP,CAiCH,CApCE,CAsCV,CA9CC,CAAN","sourcesContent":["/**\n * Javascript controller for launching the migration tool modal.\n *\n * @package   turnitintooltwo\n * @copyright Turnitin\n * @author 2019 David Winn <dwinn@turnitin.com>\n * @module mod_turnitintooltwo/migration_tool_launch\n */\n\ndefine(['jquery',\n        'core/templates',\n        'core/modal_factory',\n        'core/modal_events',\n        'mod_turnitintooltwo/modal_migration_tool',\n        'mod_turnitintooltwo/migration_tool_migrate'\n    ],\n    function($, Templates, ModalFactory, ModalEvents, ModalMigrationTool, MigrationToolMigrate) {\n        return {\n            migration_tool_launch: function() {\n                // Check whether this assignment has been migrated in this session and redirect if so.\n                $.ajax({\n                    \"dataType\": 'json',\n                    \"type\": \"POST\",\n                    \"url\": M.cfg.wwwroot + \"/mod/turnitintooltwo/ajax.php\",\n                    \"data\": {\n                        action: \"check_migrated\",\n                        turnitintoolid: $(\"#migrate_type\").data(\"turnitintoolid\"),\n                        sesskey: M.cfg.sesskey\n                    },\n                    \"success\": function(data) {\n                        if (data.migrated === true) {\n                            window.location.href = M.cfg.wwwroot + \"/mod/turnitintooltwo/view.php?id=\"+data.v2id;\n                        } else {\n                            ModalFactory.create({\n                                type: ModalMigrationTool.TYPE\n                            })\n                            .then(function(modal) {\n                                modal.show();\n\n                                // During automatic migration, we don't need to ask to migrate.\n                                if ($('#migrate_type').data(\"migratetype\") === 2) {\n                                    $('.asktomigrate').hide();\n                                    $('.migrating').show();\n\n                                    MigrationToolMigrate.migration_tool_migrate(\n                                        $(\"#migrate_type\").data(\"courseid\"),\n                                        $(\"#migrate_type\").data(\"turnitintoolid\")\n                                    );\n                                }\n                            });\n                        }\n                    }\n                });\n            }\n        };\n    }\n);"],"file":"migration_tool_launch.min.js"}