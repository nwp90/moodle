{"version":3,"sources":["../src/build.js"],"names":["define","$","jqui","str","maxwidth","initstate","TWO_JOBS_PRIORITY","MISSED_OUT_PRIORITY","teamAssignments","teamNames","selectedStudents","preventStudentClick","strings","options","criterionHTML","subcriterionHTML","buildstrings","s","any","all","none","or","and","addnewsubcriterion","criterionquestion","criterionsubquestion","replace","setup","each","val","html","buttons","find","click","x","parseInt","updateTeams","empty","append","width","on","evt","details","studentID","exec","attr","myResponses","responses","detailsTable","i","questions","q","qr","j","answers","a","inArray","id","push","answer","row","question","join","document","body","css","pageX","pageY","mdevent","target","get","remove","unbind","mousedown","moto","moevent","stresponse","closest","length","setTimeout","clearTimeout","mouseover","teamHeader","teamName","teamTextBox","height","textBoxDone","replaceWith","parent","index","keypress","keyCode","focus","select","addNewCriterion","numTeams","synchroniseViewToModel","slice","synchroniseModelToView","resetTeams","updateRunningCounter","criterion","c","getCriterionObjectFromView","ctr","students","studentMeetsCriterion","getResponsesForQuestion","questionID","responseContainer","ul","change","children","value","nextAll","next","before","hover","fadeIn","fadeOut","hide","prev","slideUp","oper","slideDown","addSubcriterion","obj","subcriterion","teamDiv","teamIndex","assignments","sortdict","connectWith","start","sortable","team","studentDiv","detach","assignRandomly","view","subcriteria","buildTeams","predicate","criterionGroup","prioritise","unassignedStudents","assignedStudents","rslt","k","v","teamsPriority","initTeamsList","teamsSortingFunction","b","studentsSortingFunction","studentPriority","__debug","cg","ucandidates","acandidates","studentsMeetingCriterionGroup","icandidates","teamsList","randomiseArray","sort","teamsSortingFunction2","lowestTeam","lowestTeams","t","lt","randomTeam","Math","floor","random","pop","priorityTeams","otherTeams","teamQualifies","ta","candidates","student","sr","ret","ans","sc","createGroups","form","window","location","tn","assign","tnInput","input","action","name","grpid","inherit","is","nogrouping","submit","array","splice","registerEventListeners","delegate","e","init","get_strings","key","component","done"],"mappings":"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","sourcesContent":["define(['jquery', 'jqueryui', 'core/str'], function($, jqui, str) {\n\n    var maxwidth = 85; // Maximum width of a studentbox in px. initialised as the minimum possible width.\n    var initstate; // Initial state of unassigned box. used to restore when syncing between model/view.\n\n    var TWO_JOBS_PRIORITY = 1;\n    var MISSED_OUT_PRIORITY = 2;\n\n    // Teams are identified by their index in these arrays.\n    // Contains arrays of students assigned to that team.\n    var teamAssignments = [];\n    // Contains the names of teams.\n    var teamNames = [];\n    // Contains information for rendering students.\n    var selectedStudents = [];\n\n    var preventStudentClick = 0;\n\n    var strings = {};\n\n    var options = '';\n\n    var criterionHTML = '';\n\n    var subcriterionHTML = '';\n\n    var buildstrings = function(s) {\n        strings.any = s[0];\n        strings.all = s[1];\n        strings.none = s[2];\n        strings.or = s[3];\n        strings.and = s[4];\n        strings.addnewsubcriterion = s[5];\n        strings.criterionquestion = s[6];\n        strings.criterionsubquestion = s[7];\n\n        options = '<option value=\"any\">' + strings.any + '</option>';\n        options += '<option value=\"all\">' + strings.all + '</option>';\n        options += '<option value=\"none\">' + strings.none + '</option>';\n\n        var questionselect = '<select class=\"questions\"></select>';\n\n        criterionHTML = '<div class=\"criterionWrapper\"><div class=\"criterion ui-corner-all\">';\n        criterionHTML += '<div class=\"criterionDelete\"></div>';\n        criterionHTML += strings.criterionquestion\n            .replace('{question}', questionselect)\n            .replace('{options}', '<select class=\"oper\">' + options + '</select>');\n        criterionHTML += '<div class=\"answers\"></div>';\n        criterionHTML += '<div class=\"add_sub\">';\n        criterionHTML += '<a href=\"#\" class=\"addsubcriterion\" title=\"' + strings.addnewsubcriterion + '\"><img src=\"css/add_sub.png\" /></a>';\n        criterionHTML += '</div>';\n        criterionHTML += '<div class=\"subcriteria\"></div>';\n        criterionHTML += '<div class=\"runningCounter\"></div>';\n        criterionHTML += '</div><div class=\"boolOper\">' + strings.and + '</div></div>';\n\n        subcriterionHTML = '<div class=\"subcriterionWrapper\"><div class=\"criterionDelete\"></div>';\n        subcriterionHTML += strings.criterionsubquestion\n            .replace('{question}', questionselect)\n            .replace('{options}', '<select class=\"oper\">' + options + '</select>');\n        subcriterionHTML += '<div class=\"answers\"></div></div>';\n    };\n\n    var setup = function() {\n        $(\".stepper\").each(function () {\n            var val = $(this).html();\n            var spindown = \"<span><div class='ui-stepper-down'></div><span>\";\n            var spinup = \"</span><div class='ui-stepper-up'></div></span>\";\n            var buttons = $(spindown + val + spinup);\n            buttons.find(\".ui-stepper-up\").click(function () {\n                var x = parseInt(buttons.find(\"span\").html());\n                x++;\n                buttons.find(\"span\").html(x);\n                updateTeams(x);\n            });\n            buttons.find(\".ui-stepper-down\").click(function () {\n                var x = parseInt(buttons.find(\"span\").html());\n                x--;\n                if (x < 1) {\n                    x = 1;\n                }\n                buttons.find(\"span\").html(x);\n                updateTeams(x);\n            });\n            $(this).empty();\n            $(this).append(buttons);\n        });\n\n        $(\".student\").each(function () {\n            if ($(this).width() > maxwidth) {\n                maxwidth = $(this).width();\n            }\n        });\n\n        $(\".student\").each(function () {\n            $(this).width(maxwidth);\n        });\n\n        $(\"#unassigned, #teams\").on(\"mouseup\", \".student\", function (evt) {\n            if (preventStudentClick) {\n                preventStudentClick = false;\n                return;\n            }\n\n            var details = $('<div class=\"studentResponse ui-corner-all\"></div>');\n\n            var studentID = /student-(\\d+)/.exec($(this).attr(\"id\"));\n            var myResponses = responses[studentID[1]];\n\n            if (myResponses) {\n                var detailsTable = $('<table></table>');\n                details.append(detailsTable);\n                for (i in questions) {\n                    q = questions[i];\n                    qr = []; // Question responses.\n                    for (j in q.answers) {\n                        a = q.answers[j];\n                        if ($.inArray(parseInt(a.id), myResponses) != -1) {\n                            qr.push(a.answer);\n                        }\n                    }\n                    var row = $('<tr><th scope=\"row\">' + q.question + '</th><td>' + qr.join(\"<br/>\") + '</td></tr>');\n                    detailsTable.append(row);\n                }\n            } else {\n                details.html(\"This student has not responded.\");\n            }\n\n            $(document.body).append(details);\n            details.css(\"left\", evt.pageX);\n            details.css(\"top\", evt.pageY);\n\n            var mdevent = function (evt) {\n                if (evt.target != details.get(0)) {\n                    details.remove();\n                    $(document).unbind('mousedown', mdevent);\n                }\n            }\n            $(document).mousedown(mdevent);\n\n            var moto; // Mouseover timeout.\n\n            var moevent = function (evt) {\n                stresponse = $(evt.target).closest(\".studentResponse\");\n                if (evt.target != this &&\n                    (stresponse.length == 0 || (stresponse.length > 0 && details.get(0) != stresponse.get(0)))) {\n                    if (moto == undefined) {\n                        moto = setTimeout(function () {\n                            details.remove();\n                        }, 500);\n                    }\n                }\n                else {\n                    if (moto) {\n                        clearTimeout(moto);\n                    }\n                }\n            }\n            $(document).mouseover(moevent);\n\n        });\n\n        $(\"#teams\").on(\"click\", \".team > h2\", function (evt) {\n            var teamHeader = $(evt.target);\n            var teamName = teamHeader.html();\n            var teamTextBox = $('<input type=\"text\" value=\"' + teamName + '\" />');\n            teamTextBox.css('font-size', teamHeader.css('font-size'));\n            teamTextBox.width(teamHeader.width());\n            teamTextBox.height(teamHeader.height());\n            teamTextBox.css('border-width', '0px');\n\n            function textBoxDone() {\n                var teamHeader = $(\"<h2>\" + teamTextBox.val() + \"</h2>\");\n                teamHeader.width(teamTextBox.width());\n                teamHeader.height(teamTextBox.height());\n                teamTextBox.replaceWith(teamHeader);\n                teamNames[teamHeader.parent().index()] = teamHeader.html();\n            }\n\n            // Conditionally attach the textBoxDone event if you click outside the textbox.\n            var mdevent = function (evt) {\n                if (evt.target != teamTextBox.get(0)) {\n                    textBoxDone();\n                    $(document).unbind('mousedown', mdevent);\n                }\n            }\n            $(document).mousedown(mdevent);\n            // If you press return.\n            teamTextBox.keypress(function (evt) {\n                if (evt.keyCode == 13) // Return character.\n                {\n                    textBoxDone();\n                    $(document).unbind('mousedown', mdevent);\n                }\n            });\n\n            teamHeader.replaceWith(teamTextBox);\n            teamTextBox.focus();\n            teamTextBox.select();\n        })\n\n        initstate = $(\"#unassigned\").html();\n\n        updateTeams(2);\n\n        addNewCriterion();\n\n    };\n\n    var updateTeams = function(numTeams) {\n\n        synchroniseViewToModel();\n\n        // Slice off the end of the teams array if needed.\n        if (teamAssignments.length > numTeams) {\n            teamAssignments = teamAssignments.slice(0, numTeams);\n        }\n\n        // Slice off the end of the names array if needed.\n        if (teamNames.length > numTeams) {\n            teamNames = teamNames.slice(0, numTeams);\n        }\n        else if (teamNames.length < numTeams) {\n            for (i = teamNames.length - 1; i < numTeams; i++) {\n                teamNames[i] = \"Team \" + (i + 1);\n            }\n        }\n        synchroniseModelToView();\n\n    };\n\n    var resetTeams = function() {\n        selectedStudents = [];\n        for (var i = 0; i < teamAssignments.length; i++) {\n            teamAssignments[i] = [];\n        }\n        synchroniseModelToView();\n        $(\"#debug\").html(\"\");\n    };\n\n    var updateRunningCounter = function(criterion) {\n        var c = getCriterionObjectFromView(criterion);\n        ctr = 0;\n        for (i in students) {\n            if (responses[i] === false) { // Don't count students with no response.\n                continue;\n            }\n            if (studentMeetsCriterion(i, c)) {\n                ctr++;\n            }\n        }\n        criterion.find(\".runningCounter\").html(ctr);\n        if (ctr < teamNames.length) {\n            criterion.find(\".runningCounter\").css(\"color\", \"#E9AAAA\");\n        } else {\n            criterion.find(\".runningCounter\").css(\"color\", \"\");\n        }\n    };\n\n    var getResponsesForQuestion = function(questionID, responseContainer) {\n        q = questions[questionID];\n        var ul = $(\"<ul></ul>\");\n        for (a in q.answers) {\n            answer = q.answers[a];\n            ul.append('<li><input type=\"checkbox\" value=\"' + answer.id + '\">' + answer.answer + '</input></li>');\n        }\n\n        responseContainer.closest(\".criterionWrapper\").find(\".runningCounter\").empty();\n        responseContainer.empty().append(ul);\n\n        responseContainer.closest(\".criterionWrapper\").find(\"ul input,select.oper\").change(function () {\n            updateRunningCounter($(this).closest(\".criterionWrapper\").children(\".criterion\"));\n        });\n    };\n\n    var addNewCriterion = function() {\n        if (!$(\"#predicate\").length) {\n            return;\n        }\n        var criterion = $(criterionHTML);\n\n        // Insert the question data.\n        // Questions is defined in the document (by PHP).\n        for (var i in questions) {\n            q = questions[i];\n            criterion.find(\".questions\").append('<option value=\"' + q.id + '\">' + q.question + '</option>');\n        }\n\n        // Add our behaviours.\n        // Question select behaviour.\n        criterion.find(\".questions\").change(function () {\n            getResponsesForQuestion(this.value, $(this).nextAll(\".answers:first\"));\n            if (questions[this.value]['type'] == 'one') {\n                $(this).next(\".oper\").children(\"[value='all']\").remove();\n            } else {\n                // To prevent duplicates, remove all instances of 'all' then add back in.\n                $(this).next(\".oper\").children(\"[value='all']\").remove();\n                $(this).nextAll(\".oper:first\").children(\"[value='none']\").before('<option value=\"all\">all</option>');\n            }\n        });\n        criterion.find(\".questions *:selected\").change();\n\n        // Delete button behaviours.\n        criterion.find(\".criterion\").hover(function () {\n            $(this).children('.criterionDelete').fadeIn(100);\n        }, function () {\n            $(this).children('.criterionDelete').fadeOut(100);\n        });\n\n        criterion.find('.criterionDelete').click(function () {\n            $(this).hide();\n            $(this).closest('.criterionWrapper').prev('.criterionWrapper').find('.boolOper').slideUp(300);\n            $(this).closest('.criterionWrapper').slideUp(300, function () {\n                $(this).remove();\n            });\n        });\n\n        // Bool oper behaviours.\n        criterion.find(\".boolOper\").click(function () {\n            var oper = $(this).html();\n            if (oper == strings.and) {\n                oper = strings.or;\n            } else {\n                oper = strings.and;\n            }\n            $(this).html(oper);\n        });\n        criterion.find(\".boolOper\").hide();\n\n        // Show the previously hidden boolOper.\n        $(\"#predicate .boolOper\").slideDown(100);\n        $(\"#predicate\").append(criterion);\n        criterion.slideDown(300);\n    };\n\n    var addSubcriterion = function(obj) {\n\n        var criterion = $(obj).closest(\".criterionWrapper\");\n        var subcriterion = $(subcriterionHTML);\n\n        criterion.find(\".subcriteria\").append(subcriterion);\n\n        for (var i in questions) {\n            q = questions[i];\n            subcriterion.find(\".questions\").append('<option value=\"' + q.id + '\">' + q.question + '</option>');\n        }\n\n        subcriterion.find(\".questions\").change(function () {\n            getResponsesForQuestion(this.value, $(this).nextAll(\".answers:first\"));\n            if (questions[this.value]['type'] == 'one') {\n                $(this).next(\".oper\").children(\"[value='all']\").remove();\n            } else {\n                $(this).nextAll(\".oper:first\").children(\"[value='none']\").before('<option value=\"all\">all</option>');\n            }\n        });\n        subcriterion.find(\".questions *:selected\").change();\n\n        subcriterion.hover(function () {\n            $(this).find('.criterionDelete').fadeIn(100);\n        }, function () {\n            $(this).find('.criterionDelete').fadeOut(100);\n        });\n\n        subcriterion.find('.criterionDelete').click(function () {\n            $(this).hide();\n            $(this).closest('.subcriterionWrapper').slideUp(300, function () {\n                var c = $(this).closest(\".criterionWrapper\").children(\".criterion\");\n                $(this).remove();\n                updateRunningCounter(c);\n            });\n        });\n\n    };\n\n    var synchroniseViewToModel = function() {\n        // First clear out our model.\n        teamAssignments = [];\n        $(\".team\").each(function () {\n            var teamDiv = $(this);\n            var teamIndex = $(this).index();\n            var assignments = [];\n            teamDiv.find(\".student\").each(function () {\n                var studentID = /student-(\\d+)/.exec($(this).attr(\"id\"))\n                assignments.push(studentID[1]); // Slot 1 contains the group we want.\n            });\n            teamAssignments[teamIndex] = assignments;\n        });\n    };\n\n    var synchroniseModelToView = function() {\n        // Reset our view.\n        $(\"#unassigned\").html(initstate);\n        $(\"#teams\").empty();\n\n        // Create our team views.\n        for (var i = 0; i < teamNames.length; i++) {\n            var teamDiv = $('<div class=\"team\" id=\"team-' + i + '\" />');\n            teamDiv.append(\"<h2>\" + teamNames[i] + \"</h2>\");\n            teamDiv.width(maxwidth + 30);\n            teamDiv.append('<div class=\"sortable\"></div>');\n            $(\"#teams\").append(teamDiv);\n        }\n\n        // Get our sortable states happening.\n        var sortdict = {\n            connectWith: \".sortable\",\n            start: function() {\n                preventStudentClick = true;\n            }\n        };\n        $(\"#teams .sortable\").sortable(sortdict);\n        $(\"#unassigned .sortable\").sortable(sortdict);\n\n        // Now to move our students to our teams.\n        for (i in teamAssignments) {\n            var team = teamAssignments[i];\n            var teamDiv = $(\"#team-\" + i + \" > div.sortable\");\n            for (j in team) {\n                var studentID = team[j];\n                var studentDiv = $(\"#student-\" + studentID);\n                studentDiv.detach();\n                teamDiv.append(studentDiv);\n                if ($.inArray(studentID, selectedStudents) != -1) {\n                    studentDiv.css(\"color\", \"green\");\n                }\n                else {\n                    studentDiv.css(\"color\", \"\");\n                }\n            }\n        }\n        $('#assignrandomly').on('click', assignRandomly);\n    };\n\n    var getCriterionObjectFromView = function(view) {\n        var criterion = {};\n\n        criterion.question = $(view).children(\".questions\").find(\"*:selected\").val();\n        criterion.answers = [];\n        criterion.oper = $(view).children(\".oper\").find(\"*:selected\").val();\n        $(view).children(\".answers\").find(\"input:checked\").each(function () {\n            criterion.answers.push(this.value);\n        });\n\n        // Subcriteria.\n\n        criterion.subcriteria = [];\n        subcriteria = $(view).children(\".subcriteria\");\n        subcriteria.find(\".subcriterionWrapper\").each(function () {\n            var subcriterion = {};\n            subcriterion.question = $(this).children(\".questions\").find(\"*:selected\").val();\n            subcriterion.answers = [];\n            subcriterion.oper = $(this).children(\".oper\").find(\"*:selected\").val();\n            $(this).children(\".answers\").find(\"input:checked\").each(function () {\n                subcriterion.answers.push(this.value);\n            });\n            criterion.subcriteria.push(subcriterion);\n        });\n\n        return criterion;\n    };\n\n    /*\n\n     Assignment psuedocode:\n\n     for each criterion:\n     if (number of candidates who meet the criterion who are not on any teams) >= (minimum number of teams):\n     for each candidate who meets the criterion who is not on a team:\n     assign candidate to a random team\n     else if (number of candidates who meet the criterion) >= (minimum number of teams):\n     get a list of teams with members who already meet this criterion\n     for each candidate who meets the criterion who is not on a team:\n     assign candidate to a random team not on that list\n     else:\n     get a list of teams with no members who meet this criterion\n     for each candidate who meets the criterion who is not on a team:\n     assign candidate to a random team on that list\n     increase 'priority' of teams who did not get a member for this criterion\n     -- when getting lists, teams are sorted first randomly, then by priority\n\n     */\n\n    var buildTeams = function() {\n        resetTeams();\n\n        synchroniseViewToModel();\n\n        selectedStudents = [];\n\n        // Build our predicate based on the UI.\n\n        var predicate = [];\n        var criterionGroup = []; // Temp var for running criterion group.\n        $(\"#predicate .criterionWrapper\").each(function () {\n            var criterion = getCriterionObjectFromView($(this).children(\".criterion\"));\n            criterionGroup.push(criterion);\n            if ($(this).find(\".boolOper\").html() == strings.and) {\n                predicate.push(criterionGroup);\n                criterionGroup = [];\n            }\n        });\n\n        // Options.\n        var prioritise = $(\"#prioritise\").val();\n\n        unassignedStudents = {};\n        assignedStudents = {};\n        $(\"#unassigned .student\").each(function () {\n            rslt = /student-(\\d+)/.exec(this.id);\n            unassignedStudents[rslt[1]] = students[rslt[1]];\n        });\n        $(\".team .student\").each(function () {\n            rslt = /student-(\\d+)/.exec(this.id);\n            assignedStudents[rslt[1]] = students[rslt[1]];\n        });\n\n        // Get rid of students with no responses.\n        $.each(responses, function (k, v) {\n            if (v === false) {\n                delete assignedStudents[k];\n                delete unassignedStudents[k];\n            }\n        });\n\n        // Initialise teamsPriority to all zeroes.\n        teamsPriority = [];\n        initTeamsList = [];\n        for (i = 0; i < teamNames.length; i++) {\n            teamsPriority.push(0);\n            initTeamsList.push(i);\n        }\n\n        for (i in predicate) {\n            __debug(\"Criterion \" + i);\n            cg = predicate[i]; // Criterion group.\n            ucandidates = []; // Unassigned candidates.\n            acandidates = []; // Assigned candidates.\n\n            // Get candidates matching criterion group.\n            ucandidates = studentsMeetingCriterionGroup(unassignedStudents, cg);\n            acandidates = studentsMeetingCriterionGroup(assignedStudents, cg);\n            studentPriority = {};\n            // Initialise studentPriority.\n            for (j in unassignedStudents) {\n                studentPriority[j] = 0;\n            }\n\n            // This is done to optimise the selection process\n            // in this case priority will be an index of how much a student should NOT be selected for this criterion,\n            // because they will be more useful in future selections.\n            for (j = predicate.length - 1; j > i; j--) {\n                // Count backwards from the end, reducing student priority as it becomes more likely that they will be needed again\n                // note that this is only relevant for unassigned students.\n                icandidates = studentsMeetingCriterionGroup(unassignedStudents, predicate[j]);\n                for (k in icandidates) {\n                    s = icandidates[k];\n                    studentPriority[s]++;\n                }\n            }\n\n            __debug(studentPriority);\n\n            teamsList = initTeamsList.slice(0);\n            teamsList = randomiseArray(teamsList);\n\n            // This function will be comparing team indices in teamsList, so it needs to compare their priorities.\n            function teamsSortingFunction(a, b) {\n                return teamsPriority[a] - teamsPriority[b];\n            }\n\n            teamsList = teamsList.sort(teamsSortingFunction);\n\n            if (prioritise == \"numbers\") {\n                function teamsSortingFunction2(a, b) {\n                    return teamAssignments[a].length - teamAssignments[b].length;\n                }\n\n                teamsList = teamsList.sort(teamsSortingFunction2);\n                __debug(\"teams list\");\n                __debug(teamAssignments);\n                __debug(teamsList)\n\n                TWO_JOBS_PRIORITY = 2;\n            } else {\n                TWO_JOBS_PRIORITY = 1;\n            }\n\n            ucandidates = randomiseArray(ucandidates);\n            acandidates = randomiseArray(acandidates);\n\n            // This function sorts like the above function, only it compares student priorities.\n            function studentsSortingFunction(a, b) {\n                return studentPriority[a] - studentPriority[b];\n            }\n\n            ucandidates = ucandidates.sort(studentsSortingFunction);\n\n            if (ucandidates.length >= teamNames.length) {\n                // Best case scenario - assign at random.\n                __debug(\"Best case\");\n                __debug(ucandidates);\n                unassignedStudents = ucandidates;\n\n                while (unassignedStudents.length > 0) {\n                    // Get the team(s) with the lowest numbers.\n                    var lowestTeam = 0;\n                    var lowestTeams = [];\n\n                    // Skip the 0th team since otherwise we compare it to itself.\n                    for (j = 1; j < teamAssignments.length; j++) {\n                        t = teamAssignments[j];\n                        lt = teamAssignments[lowestTeam];\n\n                        if (t.length < lt.length) {\n                            lowestTeam = j;\n                            lowestTeams = [];\n                        } else if (t.length == lt.length) {\n                            lowestTeams.push(j);\n                        }\n                    }\n                    lowestTeams.push(lowestTeam);\n\n                    // Pick a random team from the list of lowest teams.\n                    do {\n                        randomTeam = Math.floor(Math.random() * lowestTeams.length);\n                        // On the OFF CHANCE that Math.random() produces 1, loop.\n                    } while (randomTeam >= lowestTeams.length);\n                    teamAssignments[lowestTeams[randomTeam]].push(unassignedStudents.pop());\n                }\n            }\n            else {\n                if (ucandidates.length + acandidates.length < teamNames.length) {\n                    __debug(\"Worst case\")\n                } else {\n                    __debug(\"Worse case\");\n                }\n                __debug(ucandidates);\n                __debug(acandidates);\n                // Get a list of teams with members who already meet this criterion.\n                var priorityTeams = []; // Teams with no members who meet this criterion.\n                var otherTeams = []; // Teams with members who meet this criterion.\n                for (j in teamsList) {\n                    t = teamsList[j];\n                    var teamQualifies = true; // Rendered false if team already has a member who meets this criterion.\n\n                    for (k in acandidates) {\n                        c = acandidates[k];\n                        ta = teamAssignments[t];\n                        if ($.inArray(c, ta) != -1) { // If student k is already on team t.\n                            teamQualifies = false;\n                        }\n                    }\n\n                    if (teamQualifies) {\n                        priorityTeams.push(t);\n                        // Cover our worst case - not enough people to go around.\n                        teamsPriority[t] += MISSED_OUT_PRIORITY;\n                    }\n                    else {\n                        otherTeams.push(t);\n                        teamsPriority[t] += TWO_JOBS_PRIORITY;\n                    }\n                }\n\n                // Now we have our list of teams split in two, first take the priority teams and assign to them.\n                for (j in ucandidates) {\n                    if (j < priorityTeams.length) {\n                        t = priorityTeams[j];\n                        s = ucandidates[j];\n                        teamAssignments[t].push(s);\n                        teamsPriority[t] -= MISSED_OUT_PRIORITY;\n                    }\n                    else {\n                        x = j - priorityTeams.length;\n                        t = otherTeams[x];\n                        s = ucandidates[j];\n                        teamAssignments[t].push(s);\n                        teamsPriority[t] -= TWO_JOBS_PRIORITY; // Looks like this team didn't miss out after all!\n                    }\n                }\n\n            }\n\n            // First refresh our assignedStudents and unassignedStudents arrays from teamAssignments.\n            for (j in teamAssignments) {\n                t = teamAssignments[j];\n                for (k in unassignedStudents) {\n                    s = unassignedStudents[k];\n                    if ($.inArray(k, t) != -1) {\n                        // Move from unassigned to assigned.\n                        assignedStudents[k] = s;\n                        delete unassignedStudents[k];\n                        selectedStudents.push(k);\n                    }\n                }\n            }\n\n            __debug(teamAssignments);\n            __debug(teamsPriority);\n\n            __debug(\"<br/>\");\n\n        }\n\n        synchroniseModelToView();\n\n    };\n\n    var studentsMeetingCriterionGroup = function(students, criterionGroup) {\n        candidates = [];\n        for (c in criterionGroup) {\n            criterion = criterionGroup[c];\n\n            // Get the candidates who that meet the criterion.\n            for (s in students) {\n                if (studentMeetsCriterion(s, criterion)) {\n                    if ($.inArray(s, candidates) == -1) {\n                        candidates.push(s);\n                    }\n                }\n            }\n        }\n        return candidates;\n    };\n\n    var studentMeetsCriterion = function(student, criterion) {\n        var sr = responses[student]; // Student responses.\n        if (sr === false) {\n            return false; // Students without a response cannot meet a criterion.\n        }\n\n        var ret; // Return value.\n        var ans, sc;\n\n        if (criterion.oper == \"any\") {\n            ret = false;\n            for (a in criterion.answers) {\n                ans = parseInt(criterion.answers[a]);\n                if ($.inArray(ans, sr) != -1) {\n                    ret = true;\n                    break;\n                }\n            }\n        }\n        else if (criterion.oper == \"all\") {\n            ret = true;\n            for (a in criterion.answers) {\n                ans = parseInt(criterion.answers[a]);\n                if ($.inArray(ans, sr) == -1) {\n                    ret = false;\n                    break;\n                }\n            }\n        }\n        else if (criterion.oper == \"none\") {\n            ret = true;\n            for (a in criterion.answers) {\n                ans = parseInt(criterion.answers[a]);\n                if ($.inArray(ans, sr) != -1) {\n                    ret = false;\n                }\n            }\n        }\n\n        if (ret && criterion.subcriteria) {\n            for (i = 0; i < criterion.subcriteria.length; i++) {\n                sc = criterion.subcriteria[i];\n                ret = studentMeetsCriterion(student, sc);\n                if (ret == false) {\n                    break;\n                }\n            }\n        }\n        return ret;\n    };\n\n    var assignRandomly = function() {\n        synchroniseViewToModel();\n        var unassignedStudents = [];\n        $(\"#unassigned .student\").each(function () {\n            rslt = /student-(\\d+)/.exec(this.id);\n            unassignedStudents.push(rslt[1]);\n        });\n        unassignedStudents = randomiseArray(unassignedStudents);\n        while (unassignedStudents.length > 0) {\n            // Get the team(s) with the lowest numbers.\n            var lowestTeam = 0;\n            var lowestTeams = [];\n\n            // Skip the 0th team since otherwise we compare it to itself.\n            for (i = 1; i < teamAssignments.length; i++) {\n                t = teamAssignments[i];\n                lt = teamAssignments[lowestTeam];\n\n                if (t.length < lt.length) {\n                    lowestTeam = i;\n                    lowestTeams = [];\n                } else if (t.length == lt.length) {\n                    lowestTeams.push(i);\n                }\n            }\n            lowestTeams.push(lowestTeam);\n\n            // Pick a random team from the list of lowest teams.\n            do {\n                randomTeam = Math.floor(Math.random() * lowestTeams.length);\n                // On the OFF CHANCE that Math.random() produces 1, loop.\n            } while (randomTeam >= lowestTeams.length);\n            teamAssignments[lowestTeams[randomTeam]].push(unassignedStudents.pop());\n        }\n\n        synchroniseModelToView();\n    };\n\n    var createGroups = function() {\n        // How this works is, we're going to create an invisible form and submit it\n        // acutally i don't know if we can do that but we'll try.\n\n        synchroniseViewToModel();\n\n        var form = $('<form action=\"' + window.location + '\" method=\"POST\"></form>');\n\n        for (i = 0; i < teamNames.length; i++) {\n            var tn = teamNames[i];\n            var assign = teamAssignments[i];\n            var tnInput = $('<input type=\"hidden\" name=\"teamnames[' + i + ']\" value=\"' + tn + '\" />');\n            form.append(tnInput)\n            var input = $('<input type=\"hidden\" name=\"teams[' + i + ']\" value=\"' + assign.join(\",\") + '\" />')\n            form.append(input);\n        }\n\n        var action = $('<input type=\"hidden\" name=\"action\" value=\"create-groups\" />');\n        var name = $('<input type=\"hidden\" name=\"groupingName\" value=\"' + $('#groupingName').val() + '\" />');\n        var grpid = $('<input type=\"hidden\" name=\"groupingID\" value=\"' + $('#groupingSelect').val() + '\" />');\n        var inherit = $('<input type=\"hidden\" name=\"inheritGroupingName\" value=\"' + ( $('#inheritGroupingName').is(\":checked\") ? 1 : 0 ) + '\" />');\n        var nogrouping = $('<input type=\"hidden\" name=\"nogrouping\" value=\"' + ( $('#nogrouping').is(\":checked\") ? 1 : 0 ) + '\" />');\n        form.append(action);\n        form.append(name);\n        form.append(grpid);\n        form.append(inherit);\n        form.append(nogrouping);\n\n        $(\"#createGroupsForm\").append(form);\n        form.submit();\n    };\n\n    var __debug = function(val) {\n        if (false) { // Set to true for debugging.\n            $(\"#debug\").append(\"<div>\" + JSON.stringify(val) + \"</div>\");\n        }\n    };\n\n    var randomiseArray = function(inArray) {\n        // Much more random than sort().\n        var ret = [];\n        var array = inArray.slice(0);\n        for (i = array.length; i > 0; i--) {\n            var index = Math.floor(Math.random() * i);\n            ret.push(array[index]);\n            array.splice(index, 1);\n        }\n        return ret;\n    };\n\n    var registerEventListeners = function() {\n        $('#addnewcriterion').on('click', addNewCriterion);\n        $('#buildteams').on('click', buildTeams);\n        $('#resetteams').on('click', resetTeams);\n        $('#assignrandomly').on('click', assignRandomly);\n        $('#creategroups').on('click', createGroups);\n        $('#predicate').delegate('.addsubcriterion', 'click', function(e) {\n            addSubcriterion(e.target);\n        });\n    };\n\n    return {\n        init: function() {\n            str.get_strings([\n                { key: 'any', component: 'mod_teambuilder' },\n                { key: 'all', component: 'mod_teambuilder' },\n                { key: 'none', component: 'mod_teambuilder' },\n                { key: 'or', component: 'mod_teambuilder' },\n                { key: 'and', component: 'mod_teambuilder' },\n                { key: 'addnewsubcriterion', component: 'mod_teambuilder' },\n                { key: 'criterionquestion', component: 'mod_teambuilder' },\n                { key: 'criterionsubquestion', component: 'mod_teambuilder' }\n            ]).done(function(s) {\n                buildstrings(s);\n                setup();\n                registerEventListeners();\n            });\n        }\n    };\n});\n"],"file":"build.min.js"}