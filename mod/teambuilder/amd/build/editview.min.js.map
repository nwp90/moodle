{"version":3,"sources":["../src/editview.js"],"names":["define","$","jqui","mdlcfg","str","notification","strings","error","enteratleasttwoanswers","enteraquestion","enteratleastonequestion","saving","types","one","any","atleastone","buildstrings","s","views","addNewAnswer","insertBefore","focus","removeLastAnswer","next","remove","deleteQuestion","object","closest","slideUp","saveQuestionnaire","e","id","target","attr","questions","questiondata","length","alert","each","question","data","answers","find","push","html","slideDown","post","wwwroot","JSON","stringify","i","questionnaire","o","eq","parseInt","ordinal","wait","addNewQuestion","val","type","trim","err","join","questionView","append","sortable","axis","css","click","setup","init_questions","on","evt","which","metaKey","ctrlKey","nextAll","prevAll","fn","time","queue","self","setTimeout","dequeue","window","location","href","registerEventListeners","delegate","preventDefault","init","get_strings","key","component","done"],"mappings":"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","sourcesContent":["define(['jquery', 'jqueryui', 'core/config', 'core/str', 'core/notification'], function($, jqui, mdlcfg, str, notification) {\n    /*global init_questions:true*/\n\n    // This may be set to true later in the page.\n    var interaction_disabled = false;\n\n    var strings = {\n        error: \"\",\n        enteratleasttwoanswers: \"\",\n        enteraquestion: \"\",\n        enteratleastonequestion: \"\",\n        saving: \"\",\n        types: {\n            one: \"\",\n            any: \"\",\n            atleastone: \"\",\n        }\n    };\n\n    var buildstrings = function(s) {\n        strings.error = s[0];\n        strings.enteratleasttwoanswers = s[1];\n        strings.enteraquestion = s[2];\n        strings.enteratleastonequestion = s[3];\n        strings.saving = s[4];\n        strings.types.one = s[5];\n        strings.types.any = s[6];\n        strings.types.atleastone = s[7];\n    };\n\n    var views = {\n        /*jshint multistr: true */\n        'question' : '<div class=\"question\"><table> \\\n    \t<tr> \\\n    \t\t<td rowspan=\"2\" class=\"handle\">&nbsp;</td> \\\n    \t\t<td><span class=\"questionText\"></span> <span class=\"type\"></span></td> \\\n    \t\t<td colspan=\"2\" class=\"edit\"> \\\n    \t\t\t<a class=\"deleteQuestion\">Delete</a> \\\n    \t\t</td> \\\n    \t</tr> \\\n    \t<tr> \\\n    \t\t<td class=\"answers\" colspan=\"2\"></td> \\\n    \t</tr></table></div>'\n    };\n\n    var addNewAnswer = function() {\n        $('<input type=\"text\" name=\"answers[]\" class=\"text\" /><br/>').insertBefore(\"#answerSection button:first\").focus();\n        return false;\n    };\n\n    var removeLastAnswer = function() {\n        $('#answerSection input:last').next().remove();\n        $('#answerSection input:last').remove();\n    };\n\n    var deleteQuestion = function(object) {\n        $(object).closest(\"div.question\").slideUp(300,function(){\n            $(this).remove();\n        });\n    };\n\n    var saveQuestionnaire = function(e) {\n        var id = $(e.target).attr('data-id');\n        var questions = $(\"#questions div.question\");\n        var questiondata = [];\n        if (questions.length < 1) {\n            notification.alert(strings.error, strings.enteratleastonequestion);\n            return;\n        }\n\n        // Iterate over the UI to get question and answer order.\n        questions.each(function() {\n            // Reorder answers.\n            var question = $(this).data(\"question\");\n            question.answers = [];\n            $(this).find(\".answers ul li\").each(function(){\n                question.answers.push($(this).html());\n            });\n            questiondata.push(question);\n        });\n\n        $(\"#savingIndicator\").html(strings.saving).slideDown(300);\n\n        $.post(\n            mdlcfg.wwwroot + '/mod/teambuilder/ajax.php',\n            {\n                'id' : id,\n                'action' : 'saveQuestionnaire',\n                'input' : JSON.stringify(questiondata)\n            },\n            function(data) {\n                for (var i in data.questionnaire) {\n                    var o = data.questionnaire[i];\n                    questions.eq(parseInt(o.ordinal)).data(\"question\",o);\n                }\n                $(\"#savingIndicator\").html(\"Saved!\").wait(2000).slideUp(300);\n            },\n            'json'\n        );\n    };\n\n    var addNewQuestion = function() {\n        var question = {};\n        question.question = $(\"#newQuestionForm input[name='question']\").val();\n        question.type = $(\"#newQuestionForm select\").val();\n        question.answers = [];\n        $(\"#answerSection input[type='text']\").each(function() {\n            if ($.trim($(this).val()).length) {\n                question.answers.push($(this).val());\n            }\n        });\n\n        // Validate.\n        var err = [];\n        if ($.trim(question.question) == '') {\n            err.push(strings.enteraquestion);\n        }\n        if (question.answers.length <= 1) {\n            err.push(strings.enteratleasttwoanswers);\n        }\n        if (err.length) {\n            notification.alert(strings.error, err.join(\"<br />\"));\n            return;\n        }\n\n        // Initialise the view.\n        var questionView = $(views.question);\n        questionView.find(\".questionText\").html(question.question);\n        questionView.find(\".type\").html(strings.types[question.type]);\n        questionView.find(\".answers\").html(\"<ul><li>\" + question.answers.join(\"</li><li>\") + \"</li></ul>\");\n        $(\"#questions\").append(questionView);\n        questionView.find(\".answers ul\").sortable({axis : 'y'}).find(\"li\").css(\"cursor\",\"default\");\n        questionView.data(\"question\", question);\n\n        // Reset the form.\n        $(\"#newQuestionForm input\").val(\"\");\n\n        $('#saveQuestionnaire').click();\n\n        return false;\n    };\n\n    var setup = function() {\n        for (var i in init_questions) {\n            $(\"#question-\" + i).data(\"question\", init_questions[i]);\n        }\n        if (interaction_disabled == false) {\n            // Move outside of AMD function to ensure question is rendered and accessible.\n\n            $(\"#answerSection input\").on('keydown', function(evt) {\n                if ((evt.which == 13) && !(evt.metaKey || evt.ctrlKey)) {\n                    if ($(this).nextAll(\"input:first\").length == 0) {\n                        addNewAnswer();\n                    } else {\n                        $(this).nextAll(\"input:first\").focus();\n                    }\n                } else if(evt.which == 38) {\n                    $(this).prevAll(\"input:first\").focus();\n                } else if(evt.which == 40) {\n                    $(this).nextAll(\"input:first\").focus();\n                }\n            });\n\n            $(\"#newQuestionForm input\").on('keydown', function(evt) {\n                if((evt.which == 13) && (evt.metaKey || evt.ctrlKey)) {\n                    addNewQuestion();\n                    $(\"#newQuestionForm input[name='question']\").focus();\n                }\n            });\n        } else {\n            $(\"td.edit a\").remove();\n        }\n\n        $.fn.wait = function(time, type) {\n            time = time || 1000;\n            type = type || \"fx\";\n            return this.queue(type, function() {\n                var self = this;\n                setTimeout(function() {\n                    $(self).dequeue();\n                }, time);\n            });\n        };\n\n        $(\"#importButton\").click(function() {\n            window.location.href = window.location.href + \"&import=\" + $(this).prevAll(\"select:first\").val();\n        });\n\n    };\n\n    var registerEventListeners = function() {\n        $('#addNewQuestion').on('click', addNewQuestion);\n        $('#saveQuestionnaire').on('click', saveQuestionnaire);\n        $('#addnewanswer').on('click', addNewAnswer);\n        $('#removelastanswer').on('click', removeLastAnswer);\n        $('#questions').delegate('.deleteQuestion', 'click', function(e) {\n            e.preventDefault();\n            deleteQuestion(e.target);\n        });\n    };\n\n    return {\n        init: function() {\n            str.get_strings([\n                { key: 'error', component: 'error' },\n                { key: 'enteratleasttwoanswers', component: 'mod_teambuilder' },\n                { key: 'enteraquestion', component: 'mod_teambuilder' },\n                { key: 'enteratleastonequestion', component: 'mod_teambuilder' },\n                { key: 'saving', component: 'mod_teambuilder' },\n                { key: 'selectone', component: 'mod_teambuilder' },\n                { key: 'selectany', component: 'mod_teambuilder' },\n                { key: 'selectatleastone', component: 'mod_teambuilder' },\n            ]).done(function(s) {\n                buildstrings(s);\n                setup();\n            });\n            registerEventListeners();\n        }\n    };\n});\n"],"file":"editview.min.js"}