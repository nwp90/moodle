define(["jquery","jqueryui","core/config","core/str","core/notification"],function(a,b,c,d,e){/*global init_questions:true*/
// This may be set to true later in the page.
var f=!1,g={error:"",enteratleasttwoanswers:"",enteraquestion:"",enteratleastonequestion:"",saving:"",types:{one:"",any:"",atleastone:""}},h=function(a){g.error=a[0],g.enteratleasttwoanswers=a[1],g.enteraquestion=a[2],g.enteratleastonequestion=a[3],g.saving=a[4],g.types.one=a[5],g.types.any=a[6],g.types.atleastone=a[7]},i={/*jshint multistr: true */
question:'<div class="question"><table>     \t<tr>     \t\t<td rowspan="2" class="handle">&nbsp;</td>     \t\t<td><span class="questionText"></span> <span class="type"></span></td>     \t\t<td colspan="2" class="edit">     \t\t\t<a class="deleteQuestion">Delete</a>     \t\t</td>     \t</tr>     \t<tr>     \t\t<td class="answers" colspan="2"></td>     \t</tr></table></div>'},j=function(){return a('<input type="text" name="answers[]" class="text" /><br/>').insertBefore("#answerSection button:first").focus(),!1},k=function(){a("#answerSection input:last").next().remove(),a("#answerSection input:last").remove()},l=function(b){a(b).closest("div.question").slideUp(300,function(){a(this).remove()})},m=function(b){var d=a(b.target).attr("data-id"),f=a("#questions div.question"),h=[];
// Iterate over the UI to get question and answer order.
return f.length<1?void e.alert(g.error,g.enteratleastonequestion):(f.each(function(){
// Reorder answers.
var b=a(this).data("question");b.answers=[],a(this).find(".answers ul li").each(function(){b.answers.push(a(this).html())}),h.push(b)}),a("#savingIndicator").html(g.saving).slideDown(300),void a.post(c.wwwroot+"/mod/teambuilder/ajax.php",{id:d,action:"saveQuestionnaire",input:JSON.stringify(h)},function(b){for(var c in b.questionnaire){var d=b.questionnaire[c];f.eq(parseInt(d.ordinal)).data("question",d)}a("#savingIndicator").html("Saved!").wait(2e3).slideUp(300)},"json"))},n=function(){var b={};b.question=a("#newQuestionForm input[name='question']").val(),b.type=a("#newQuestionForm select").val(),b.answers=[],a("#answerSection input[type='text']").each(function(){a.trim(a(this).val()).length&&b.answers.push(a(this).val())});
// Validate.
var c=[];if(""==a.trim(b.question)&&c.push(g.enteraquestion),b.answers.length<=1&&c.push(g.enteratleasttwoanswers),c.length)return void e.alert(g.error,c.join("<br />"));
// Initialise the view.
var d=a(i.question);
// Reset the form.
return d.find(".questionText").html(b.question),d.find(".type").html(g.types[b.type]),d.find(".answers").html("<ul><li>"+b.answers.join("</li><li>")+"</li></ul>"),a("#questions").append(d),d.find(".answers ul").sortable({axis:"y"}).find("li").css("cursor","default"),d.data("question",b),a("#newQuestionForm input").val(""),a("#saveQuestionnaire").click(),!1},o=function(){for(var b in init_questions)a("#question-"+b).data("question",init_questions[b]);0==f?(a("#questions").sortable({handle:".handle",axis:"y"}),a("#questions .answers ul").sortable({axis:"y"}).find("li").css("cursor","default"),a("#answerSection input").on("keydown",function(b){13!=b.which||b.metaKey||b.ctrlKey?38==b.which?a(this).prevAll("input:first").focus():40==b.which&&a(this).nextAll("input:first").focus():0==a(this).nextAll("input:first").length?j():a(this).nextAll("input:first").focus()}),a("#newQuestionForm input").on("keydown",function(b){13==b.which&&(b.metaKey||b.ctrlKey)&&(n(),a("#newQuestionForm input[name='question']").focus())})):a("td.edit a").remove(),a.fn.wait=function(b,c){return b=b||1e3,c=c||"fx",this.queue(c,function(){var c=this;setTimeout(function(){a(c).dequeue()},b)})},a("#importButton").click(function(){window.location.href=window.location.href+"&import="+a(this).prevAll("select:first").val()})},p=function(){a("#addNewQuestion").on("click",n),a("#saveQuestionnaire").on("click",m),a("#addnewanswer").on("click",j),a("#removelastanswer").on("click",k),a("#questions").delegate(".deleteQuestion","click",function(a){a.preventDefault(),l(a.target)})};return{init:function(){d.get_strings([{key:"error",component:"error"},{key:"enteratleasttwoanswers",component:"mod_teambuilder"},{key:"enteraquestion",component:"mod_teambuilder"},{key:"enteratleastonequestion",component:"mod_teambuilder"},{key:"saving",component:"mod_teambuilder"},{key:"selectone",component:"mod_teambuilder"},{key:"selectany",component:"mod_teambuilder"},{key:"selectatleastone",component:"mod_teambuilder"}]).done(function(a){h(a),o()}),p()}}});