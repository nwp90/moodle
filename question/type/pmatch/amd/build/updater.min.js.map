{"version":3,"sources":["../src/updater.js"],"names":["define","$","t","baseUrl","sessKey","qid","headerCheckboxChecked","init","base","attr","replace","val","document","on","id","data","update","e","keyCode","which","preventDefault","trigger","click","M","util","get_string","each","checked","prop","text","ef","rid","expectedfraction","sesskey","post","result","status","parent","prev","gf","tr","removeClass","addClass","rowclass","find","c","counts","html","window","console","log"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This class provides functionality for the testquestion response updater.\n *\n * @module    qtype_pmatch\n * @class     updater\n * @package   question\n * @copyright 2016 The Open University\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery'], function($) {\n\n    /**\n     * @alias qtype_pmatch/updater\n     */\n    var t = {\n        baseUrl: '',\n        sessKey: '',\n        qid: '',\n        headerCheckboxChecked: true,\n\n        /**\n         * Initialise the updater.\n         */\n        init: function() {\n            var base = $('#attemptsform').attr('action');\n            t.baseUrl = base.replace('testquestion.php', 'api/updater.php');\n            t.sessKey = $('#attemptsform input[name=\"sesskey\"]').val();\n            t.qid = $('#attemptsform input[name=\"id\"]').val();\n            $(document).on('click', '.updater-ef', function() {\n                var id = $(this).data('id');\n                t.update(id);\n                return false;\n            });\n            // Prevent the form submit when user press enter on checkbox.\n            $(document).on('keypress', '#tablecontainer :checkbox', function(e) {\n                if ((e.keyCode ? e.keyCode : e.which) == 13) {\n                    e.preventDefault();\n                    $(this).trigger('click');\n                }\n            });\n            $('#tqheadercheckbox').click(function() {\n                if (t.headerCheckboxChecked) {\n                    $(this).attr('title', M.util.get_string('deselectall', 'moodle'));\n                    t.headerCheckboxChecked = false;\n                } else {\n                    $(this).attr('title', M.util.get_string('selectall', 'moodle'));\n                    t.headerCheckboxChecked = true;\n                }\n                $('#tablecontainer :checkbox').each(function() {\n                    this.checked = !t.headerCheckboxChecked;\n                });\n                $(this).prop('checked', false);\n            });\n        },\n        update: function(id) {\n            var val = $('#updater-ef_' + id).text();\n            var ef = 0;\n            if (val === '1') {\n                ef = 0;\n            } else {\n                ef = 1;\n            }\n            // Send update.\n            var data = {qid: t.qid, rid: id, expectedfraction: ef, sesskey: t.sessKey};\n            $.post(t.baseUrl, data, function(result) {\n                if (result.status === 'success') {\n                    // Update the ui.\n                    $('#updater-ef_' + id).text(result.ef);\n                    $('#updater-ef_' + id).parent().prev().text(result.gf);\n                    var tr = $('#updater-ef_' + id).parent().parent();\n                    tr.removeClass();\n                    tr.addClass(result.rowclass);\n                    tr.find('td[class=\"c3\"]').text(result.gf);\n                    // Update the grade summary.\n                    var c = M.util.get_string('testquestionresultssummary', 'qtype_pmatch', result.counts);\n                    $('#testquestion_gradesummary').html(c);\n                } else {\n                    // Developer debugging - failure states are in api/updater.php.\n                    window.console.log(\n                        'Testquestion response updater has experienced an issue.\\n' + result.data);\n                    // If spinner is added - remove it here $('#updater-ef_' + id).text(val);.\n                }\n            });\n        }\n    };\n\n    return t;\n});\n"],"file":"updater.min.js"}