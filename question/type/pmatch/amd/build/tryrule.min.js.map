{"version":3,"sources":["../src/tryrule.js"],"names":["define","$","t","baseUrl","sessKey","qid","pendingid","init","Math","random","toString","slice","base","window","location","protocol","host","pathname","replace","val","each","id","attr","parent","next","find","on","e","preventDefault","tryrule","M","util","js_pending","rule","trim","display","fraction","data","type","ruletxt","sesskey","post","result","html","js_complete"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This class provides functionality for try rule.\n *\n * This is based on the work of Dr Alistair Willis published:\n * http://aclweb.org/anthology/W/W15/W15-0628.pdf\n *\n * @module    qtype_pmatch\n * @class     tryrule\n * @package   question\n * @copyright 2016 The Open University\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since     2.9\n */\ndefine(['jquery'], function($) {\n\n    /**\n     * @alias qtype_pmatch/tryrule\n     */\n    var t = {\n        baseUrl: '',\n        sessKey: '',\n        qid: '',\n        pendingid: '',\n\n        /**\n         * Initialise the try rule button.\n         */\n        init: function() {\n            // Set up base variables.\n            t.pendingid = 'tryrule_' + Math.random().toString(36).slice(2); // Random string.\n            var base = window.location;\n            t.baseUrl = base.protocol + '//' + base.host +\n                    base.pathname.replace('question.php', 'type/pmatch/api/api.php');\n            t.sessKey = $('#mform1 input[name=\"sesskey\"]').val();\n            t.qid = $('#mform1 input[name=\"id\"]').val();\n            // Add ids to try rule buttons.\n            $('textarea[name^=\"answer\"]').each(function() {\n                var id = $(this).attr('id').replace('id_answer_', '');\n                $(this).parent().parent().next().next().find('input').attr('id', 'id_tryrule_' + id);\n            });\n            $('input[name=\"tryrule\"]').on('click', function(e) {\n                e.preventDefault();\n                var id = $(this).attr('id').replace('id_tryrule_', '');\n                t.tryrule(id);\n            });\n        },\n\n        tryrule: function(id) {\n            M.util.js_pending(t.pendingid);\n            var rule = $('#id_answer_' + id).val();\n            if (rule === undefined || rule === null || rule === '') {\n                return;\n            }\n            rule = rule.trim();\n            if (rule === '') {\n                return;\n            }\n            var display = $('#id_tryrule_' + id).next();\n            var fraction = $('#id_fraction_' + id).val();\n            // Send request for tryrule result.\n            var data = {type: 'tryrule', qid: t.qid, ruletxt: rule, sesskey: t.sessKey, fraction: fraction};\n            $.post(t.baseUrl, data, function(result) {\n                // Display feedback to the user.\n                display.html(result);\n                M.util.js_complete(t.pendingid);\n            }, 'json');\n        }\n    };\n\n    return t;\n});\n"],"file":"tryrule.min.js"}