YUI.add("moodle-atto_ereserve-button",function(e,t){var n="atto_ereserve",r={INPUTSUBMIT:"atto_media_urlentrysubmit",INPUTCANCEL:"atto_media_urlentrycancel"},i='<form class="atto_form" style="padding:0px">   <div id="{{elementid}}-resource-link-creation" class="mdl-align">       <iframe id="ereserve-resoruce-linking-iframe" style="border:0px;background:#ffffff;width:{{width}};height:{{height}};" src="{{iframesrc}}"></iframe>       <button id="ereserve-resource-link-insert" class="{{CSS.INPUTSUBMIT}}" style="display:none">{{get_string "insert" component}}</button>       <input id="editor_id" type="hidden" value="{{elementid}}"/>   </div></form>',s=null;e.namespace("M.atto_ereserve").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){if(this.get("disabled"))return;this._updatePaths(),this.addButton({icon:"icon",iconComponent:"atto_ereserve",buttonName:"insert_ereserve_resource_link",callback:this._displayDialogue,callbackArgs:"ereserve",title:"buttontitle"});var e=this.get("ereserve_instance_base_url"),t=this;window.addEventListener("message",function(n){var r=t.get("host").get("elementid"),i=$(".moodle-dialogue-focused #editor_id").val();if(t.get("debug")){var o="";n.origin!==e&&console.log('ERESERVE DEBUG: atto_ereserve: ERROR bad origin got "'+n.origin+'" expected "'+e+'"'),n.data.action!=="insert"&&console.log('ERESERVE DEBUG: atto_ereserve: ERROR bad data got "'+n.data.action+'" expected "insert"')}if(n.origin===e&&r===i&&n.data.action==="insert"){t.get("debug")&&console.log("ERESERVE DEBUG: atto_ereserve: Insert was requested for resource id="+n.data.resource_link_id),s=n.data.resource_link_id;var u=$(".moodle-dialogue-focused #ereserve-resource-link-insert");u.click()}},!1)},_updatePaths:function(){var e=/local\/ereserve_plus\/resource_link\/show.php\?(course_id=\d+)/g,t;t=this.editor.getHTML(),t=t.replace(e,"local/ereserve_plus/resource_link/show.php?course_id="+this.get("course_id")),this.editor.setHTML(t)},_displayDialogue:function(t,r){t.preventDefault();var i=1e3,s=550,o=this.getDialogue({headerContent:M.util.get_string("dialogtitle",n),width:i+"px",height:s+"px",draggable:!1,overflowX:"auto",constraintoviewport:!1});o.width!==i+"px"&&o.set("width",i+"px");var u=this._getFormContent(r),a=e.Node.create("<div></div>");a.append(u),o.set("bodyContent",a),o.show(),this.markUpdated()},_getFormContent:function(){var t=this.get("moodle_base_url")+"/local/ereserve_plus/resource_link/new.php?course_id="+this.get("course_id"),s=e.Handlebars.compile(i),o=e.Node.create(s({elementid:this.get("host").get("elementid"),CSS:r,component:n,iframesrc:t,width:"100%",height:"457px;",style:"border:10px solid black;"}));return this._form=o,this._form.one("."+r.INPUTSUBMIT).on("click",this._doInsert,this),o},_doInsert:function(e){e.preventDefault();var t=this.getDialogue({focusAfterHide:null});t.hide();var n="eres_res_link_"+s,r=this.get("ereserve_instance_base_url"),i=this.get("moodle_base_url")+"/local/ereserve_plus/resource_link/show.php"+"?course_id="+this.get("course_id")+"&id="+s,o="script = document.createElement('script');script.src = '"+r+"/app/scripts/resource_link_frame.js';"+"script.onload = function () { eReserve.ResourceLinking.ResourceLinkFrame.init('"+n+"', '"+r+"'); };"+"document.head.appendChild(script);",u='<iframe    id="'+n+'" '+'   class="ereserve_resource_link_frame" '+'   src="'+i+'" '+'   width="100%" '+'   height="100" '+'   frameborder="0" '+'   onload="'+o+'" '+'   scrolling="no" '+'   style="overflow: hidden"'+"   >"+"</iframe>",a=this.get("host");a.focus(),a.insertContentAtFocusPoint(u),this.markUpdated()}},{ATTRS:{disabled:{value:!1},debug:{value:!1},ereserve_instance_base_url:{value:""},moodle_base_url:{value:""},course_id:{value:null},defaultflavor:{value:""}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
