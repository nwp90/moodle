YUI.add("moodle-atto_ereserve-button",function(e,t){var n="atto_ereserve",r={INPUTSUBMIT:"atto_media_urlentrysubmit",INPUTCANCEL:"atto_media_urlentrycancel"},i='<form class="atto_form" style="padding:0px">   <div id="{{elementid}}_{{innerform}}" class="mdl-align">       <iframe id="ereserve-resoruce-linking-iframe" style="border:0px;background:#ffffff;width:{{width}};height:{{height}};" src="{{iframesrc}}"></iframe>       <button id="ereserve-resource-link-insert" class="{{CSS.INPUTSUBMIT}}" style="display:none">{{get_string "insert" component}}</button>   </div></form>',s=null;e.namespace("M.atto_ereserve").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){if(this.get("disabled"))return;this.addButton({icon:"icon",iconComponent:"atto_ereserve",buttonName:"insert_ereserve_resource_link",callback:this._displayDialogue,callbackArgs:"ereserve",title:"buttontitle"});var e=this.get("ereserve_instance_base_url"),t=this;window.addEventListener("message",function(n){if(t.get("debug")){var r="";n.origin!==e&&console.log('DEBUG atto_ereserve: ERROR bad origin got "'+n.origin+'" expected "'+e+'"'),n.data.action!=="insert"&&console.log('DEBUG atto_ereserve: ERROR bad data got "'+n.data.action+'" expected "insert"')}if(n.origin===e&&n.data.action==="insert"){t.get("debug")&&console.log("DEBUG atto_ereserve: Insert was requested for resource id="+n.data.resource_link_id),s=n.data.resource_link_id;var i=document.getElementById("ereserve-resource-link-insert");i.click()}},!1)},_displayDialogue:function(t,r){t.preventDefault();var i=1e3,s=550,o=this.getDialogue({headerContent:M.util.get_string("dialogtitle",n),width:i+"px",height:s+"px",draggable:!1,overflowX:"auto",constraintoviewport:!1});o.width!==i+"px"&&o.set("width",i+"px");var u=this._getFormContent(r),a=e.Node.create("<div></div>");a.append(u),o.set("bodyContent",a),o.show(),this.markUpdated()},_getFormContent:function(){var t=this.get("moodle_base_url")+"/local/ereserve_plus/resource_link/new.php?course_id="+this.get("course_id"),s=e.Handlebars.compile(i),o=e.Node.create(s({elementid:this.get("host").get("elementid"),CSS:r,component:n,iframesrc:t,width:"100%",height:"457px;",style:"border:10px solid black;"}));return this._form=o,this._form.one("."+r.INPUTSUBMIT).on("click",this._doInsert,this),o},_doInsert:function(e){e.preventDefault(),this.getDialogue({focusAfterHide:null}).hide();var t="eres_res_link_"+s,n=this.get("ereserve_instance_base_url"),r=this.get("moodle_base_url")+"/local/ereserve_plus/resource_link/show.php"+"?course_id="+this.get("course_id")+"&id="+s,i="script = document.createElement('script');script.src = '"+n+"/app/scripts/resource_link_frame.js';"+"script.onload = function () { eReserve.ResourceLinking.ResourceLinkFrame.init('"+t+"', '"+n+"'); };"+"document.head.appendChild(script);",o='<iframe    id="'+t+'" '+'   class="ereserve_resource_link_frame" '+'   src="'+r+'" '+'   width="100%" '+'   height="100" '+'   frameborder="0" '+'   onload="'+i+'" '+'   scrolling="no" '+'   style="overflow: hidden"'+"   >"+"</iframe>";this.editor.focus(),this.get("host").insertContentAtFocusPoint(o),this.markUpdated()}},{ATTRS:{disabled:{value:!1},debug:{value:!1},ereserve_instance_base_url:{value:""},moodle_base_url:{value:""},course_id:{value:null},defaultflavor:{value:""}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
